generator client {
  provider = "prisma-client-js"
  output   = "../../generated"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Order {
  order_id            Int             @id @default(autoincrement())
  user_id             Int
  address_id          Int?
  cart_id             Int?
  total_amount        Decimal         @db.Decimal(10, 2)
  status              order_statuses? @default(pending)
  created_at          DateTime?       @default(now()) @db.Timestamp(6)
  shipped_at          DateTime?       @db.Timestamp(6)
  delivered_at       DateTime?       @db.Timestamp(6)
  applied_discount_id Int?

  @@index([user_id])
  @@index([status])
  @@index([created_at])
  @@index([user_id, status])
  @@index([status, created_at])
}

model product {
  product_id       Int               @id @default(autoincrement())
  category_id      Int?
  name             String            @db.VarChar(100)
  description      String?           @db.VarChar(500)
  price            Decimal           @db.Decimal(10, 2)
  stock            Int?              @default(0)
  status           product_statuses? @default(active)
  image_url        String?           @db.VarChar(255)
  created_at       DateTime?         @default(now()) @db.Timestamp(6)
  updated_at       DateTime?         @default(now()) @db.Timestamp(6)
  discount_rule_id Int?

  @@index([category_id])
  @@index([status])
  @@index([created_at])
  @@index([price])
  @@index([stock])
  @@index([category_id, status])
  @@index([status, created_at])
}

model User {
  user_id       Int        @id @default(autoincrement())
  first_name    String     @db.VarChar(50)
  last_name     String     @db.VarChar(50)
  email         String     @unique @db.VarChar(100)
  password_hash String     @db.VarChar(255)
  phone         String?    @db.VarChar(20)
  role          rols?      @default(customer)
  is_active     Boolean?   @default(true)
  created_at    DateTime?  @default(now()) @db.Timestamp(6)
  updated_at    DateTime?  @default(now()) @db.Timestamp(6)

  @@index([role])
  @@index([is_active])
  @@index([created_at])
  @@index([role, is_active])
}

model review {
  review_id   Int       @id @default(autoincrement())
  user_id     Int
  product_id  Int
  rating      Int?
  comment     String?   @db.VarChar(500)
  created_at  DateTime? @default(now()) @db.Timestamp(6)
  is_approved Boolean?  @default(false)

  @@index([user_id])
  @@index([product_id])
  @@index([is_approved])
  @@index([created_at])
  @@index([user_id, product_id])
  @@index([product_id, is_approved])
}

model cart {
  cart_id    Int        @id @default(autoincrement())
  user_id    Int
  created_at DateTime?  @default(now()) @db.Timestamp(6)
  is_active  Boolean?   @default(true)

  @@index([user_id])
  @@index([is_active])
  @@index([created_at])
  @@index([user_id, is_active])
}

model cartitem {
  cart_item_id Int       @id @default(autoincrement())
  cart_id      Int
  product_id   Int
  quantity     Int
  added_at     DateTime? @default(now()) @db.Timestamp(6)

  @@index([cart_id])
  @@index([product_id])
  @@index([added_at])
  @@index([cart_id, product_id])
}

model address {
  address_id   Int          @id @default(autoincrement())
  user_id      Int
  street       String       @db.VarChar(100)
  postal_code  String       @db.VarChar(20)
  is_default   Boolean?     @default(false)

  @@index([user_id])
  @@index([is_default])
  @@index([user_id, is_default])
}

model payment {
  payment_id     Int               @id @default(autoincrement())
  order_id       Int
  method         methods
  amount         Decimal           @db.Decimal(10, 2)
  status         payment_statuses? @default(pending)
  transaction_id String?           @db.VarChar(100)
  created_at     DateTime?         @default(now()) @db.Timestamp(6)

  @@index([order_id])
  @@index([status])
  @@index([method])
  @@index([created_at])
  @@index([order_id, status])
  @@index([status, created_at])
}

model delivery {
  delivery_id     Int                @id @default(autoincrement())
  order_id        Int                @unique
  courier         String?            @db.VarChar(50)
  tracking_number String?            @db.VarChar(100)
  status          delivery_statuses? @default(preparing)
  updated_at      DateTime?          @default(now()) @db.Timestamp(6)

  @@index([status])
  @@index([order_id, status])
}

model wishlist {
  wishlist_id Int       @id @default(autoincrement())
  user_id     Int
  product_id  Int
  added_at    DateTime? @default(now()) @db.Timestamp(6)

  @@index([user_id])
  @@index([product_id])
  @@index([added_at])
  @@index([user_id, product_id])
}

model DiscountRule {
  discount_rule_id Int            @id @default(autoincrement())
  code             String         @unique @db.VarChar(50)
  type             discount_types
  value            Decimal        @db.Decimal(10, 2)
  valid_from       DateTime
  valid_to         DateTime
  is_active        Boolean?       @default(true)

  @@index([is_active])
  @@index([type])
  @@index([valid_from])
  @@index([is_active, valid_from])
}

enum delivery_statuses {
  preparing
  in_transit
  delivered
  returned
}

enum discount_types {
  percent
  fixed
}

enum methods {
  card
  paypal
  cash_on_delivery
}

enum order_statuses {
  pending
  paid
  shipped
  delivered
  cancelled
}

enum payment_statuses {
  pending
  success
  failed
  refunded
}

enum product_statuses {
  active
  hidden
  out_of_stock
}

enum rols {
  customer
  admin
  manager
  support
}

enum types {
  percent
  fixed
}

